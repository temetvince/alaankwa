* drop wares
= [THIS]-> call script 'Cmd.StripShip' :

$recycleFactor = get global variable: name='tv.mayhem_recycleFactor'
$buildDividerShip = get global variable: name='tv.mayhem_buildDividerShip'

$craftCosts = get global variable: name='tv.mayhem_craftCosts'
$cost.computerComponents = table get $craftCosts ( {Computer Components} )
$cost.microchips = table get $craftCosts ( {Microchips} )
$cost.ore = table get $craftCosts ( {Ore} )
$cost.quantumTubes = table get $craftCosts ( {Quantum Tubes} )
$cost.siliconWafers = table get $craftCosts ( {Silicon Wafers} )

$type = [THIS]-> get ware type code of object

$cost.project = get average price of ware $type

$costF.computerComponents = ($cost.project / $cost.computerComponents) / $buildDividerShip / $recycleFactor
$costF.microchips = ($cost.project / $cost.microchips) / $buildDividerShip / $recycleFactor
$costF.ore = ($cost.project / $cost.ore) / $buildDividerShip / $recycleFactor
$costF.quantumTubes = ($cost.project / $cost.quantumTubes) / $buildDividerShip / $recycleFactor
$costF.siliconWafers = ($cost.project / $cost.siliconWafers) / $buildDividerShip / $recycleFactor

$name = 
= $sanctuary-> add $costF.computerComponents units of {Computer Components}
= $sanctuary-> add $costF.microchips units of {Microchips}
= $sanctuary-> add $costF.ore units of {Ore}
= $sanctuary-> add $costF.quantumTubes units of {Quantum Tubes}
= $sanctuary-> add $costF.siliconWafers units of {Silicon Wafers}

$MainType = [THIS]-> get maintype
$SubType = [THIS]-> get subtype
$targetWare = get ware from maintype $MainType and subtype $SubType

$allProjects = get global variable: name='tv.mayhem_projects'
$alreadyKnown = table get $allProjects ( $targetWare )
$allProjects.scans = get global variable: name='tv.mayhem_scans'
$allProjects.scans.max = get global variable: name='tv.mayhem_scans.max'
$allProjects.scans.target = table get $allProjects.scans ( $targetWare )

$maker = [THIS]-> get maker race
* if not already known and race is not forbidden
if $alreadyKnown == null AND $allProjects.scans.target >= 0
 table set $allProjects ( $targetWare ) = $cost.project
 table set $allProjects.scans ( $targetWare ) = $allProjects.scans.max
 $return = 1
else if $allProjects.scans.target >= 0
 table set $allProjects.scans ( $targetWare ) = $allProjects.scans.max
 $return = 0
else
 $return = 0
end

= wait 1 ms
do if [THIS]-> exists
 [THIS]-> destruct: show no explosion=[TRUE]

return $return

